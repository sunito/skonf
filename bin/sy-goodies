#!/bin/bash

own_folder=$(dirname $(readlink -f $0))
source $(dirname $own_folder)/lib/sy-common.bash

syve_section "Telefonie"

apt_install skype

if [ $USER != sunito ] ;then
  phonestart_deactivated=true
else
  phonestart_deactivated=false
fi
mkdir $HOME/.config/autostart/
cat <<EOT >$HOME/.config/autostart/phone-slowstart.desktop
[Desktop Entry]
Exec=sleep 11;linphone --iconified
Hidden=$phonestart_deactivated
Icon=system-run
Name[de]=Telefon-Slowstart
Name=Telefon-Slowstart
StartupNotify=true
Terminal=false
Type=Application
EOT

apt_install thunderbird

syve_section "Multimedia-Programme"

apt_install libdvdread4
sudo /usr/share/doc/libdvdread4/install-css.sh

#205-Dez, Sven: veraltet: apt_install libavcodec-extra-53 # wird für Video-Konvertierung zu MP3 gebraucht

apt_install vlc
apt_install xfburn # k3b hat Macken
apt_install pavucontrol
apt_install audacity

apt_install simplescreenrecorder

# todo:  tmp dir auf andere Stellen übertragen
if false ;then
  if [ `uname -i` = "x86_64" ] ; then
    wget ftp://ftp.ubuntu.com/ubuntu/pool/universe/k/k9copy/k9copy_2.3.8-1_amd64.deb -P /tmp
    sudo dpkg -i /tmp/k9copy_2.3.8-1_amd64.deb
  fi
fi


# if [ -z `ls /etc/apt/sources.list.d |grep ps3mediaserver` ]
# then  
#   sudo add-apt-repository --yes ppa:happy-neko/ps3mediaserver
#   # Hack von: http://adam.pohorecki.pl/blog/2014/05/16/how-to-install-ps3-media-server-on-ubuntu-14-dot-04-trusty-tahr/
#   sudo sed -i s/trusty/raring/ /etc/apt/sources.list.d/happy-neko-ps3mediaserver-trusty.list
#   sudo apt-get update >/dev/null  
# fi
# apt_install ps3mediaserver

#syve_section "### simplescreenrecorder" deaktiviert, da Netrunner schon gut ausgestattet
# sudo add-apt-repository ppa:maarten-baert/simplescreenrecorder
# sudo apt-get update >/dev/null
# apt_install simplescreenrecorder

syve_section "Unterstützung für Windows-Programme installieren"

# Virtuelle Umgebungen

if [[ -z `dpkg -l virtualbox| grep "ii  virt"` ]] ;then
  wget -q -O - http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc | sudo apt-key add -
  echo "### Achtung! trusty fest verdrahtet!!! ###"
  sudo sh -c 'echo "deb http://download.virtualbox.org/virtualbox/debian trusty non-free contrib" >> /etc/apt/sources.list.d/virtualbox.org.list'
  sudo apt-get update >/dev/null 
  apt_install virtualbox-4.3
fi
apt_install xdotool   # für das vm-launch-Script

if [[ $USER = "brunhild" ]] ;then
cat <<eot >.local/share/applications/emWave.desktop
[Desktop Entry]
Comment[de_DE]=by HeartMath
Comment=by HeartMath
Exec=~/bin/vmanage/bin/vm-launch-emwave "C:\\\\Programme\\\\HeartMath\\\\emWave\\\\emwavepc.exe"
GenericName[de_DE]=emWave Pro
GenericName=emWave Pro
Icon=/dat/w4a1/emwv.png
MimeType=
Name=emWave
NoDisplay=false
Path=
StartupNotify=false
Terminal=false
TerminalOptions=
Type=Application
X-DBUS-ServiceName=
X-DBUS-StartupType=
X-KDE-SubstituteUID=false
X-KDE-Username=
eot
fi

# Wine-Emulator
apt_install wine winetricks

# Wir wollwn die neueste Version von PoL:
if [ -z `ls /etc/apt/sources.list.d |grep playonlinux` ]
then  
  sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E0F72778C4676186
  sudo wget http://deb.playonlinux.com/playonlinux_trusty.list -O /etc/apt/sources.list.d/playonlinux.list
  sudo apt-get update >/dev/null
fi
apt_install xterm playonlinux

apt_install ttf-mscorefonts-installer

apt_install winbind # needed for Office2010
# wine 1.5.2, gecko 2.40, mono-4.5.6, msxml6

syve_section "Weitere Software installieren"

# seems already installed:
# apt_install libreoffice-pdfimport 

echo "Ensure that mtools_skip_check=1 is in .mtoolsrc"
if [[ ! -f $HOME/.mtoolsr && -z `grep mtools_skip_check=1 $HOME/.mtoolsrc`  ]] ;then
  echo mtools_skip_check=1 >> $HOME/.mtoolsrc 
fi

apt_install kdiff3

apt_install qpdfview # 2014:Aug: because okular 0.19 is buggy (printing blank pages"
apt_install cups-pdf

apt_install simple-scan

apt_install transmission-qt # suse                                                                                                                                                                                                                     

apt_install scribus

if [ -z `ls /etc/apt/sources.list.d |grep retroshare` ]
then  
  sudo add-apt-repository --yes ppa:csoler-users/retroshare
  sudo apt-get update >/dev/null  
fi
# 2016-Jan, Sv: in Linux Mint Rosa scheint was mit dem Key-import nicht zu klappen, also workaround:
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys D8D05E222E10C9E3
apt_install retroshare

if [[ ! $USER = "brunhild" ]] ;then
  apt_install workrave
fi
cat <<EOT >$HOME/.config/autostart/workrave-slowstart.desktop
[Desktop Entry]
Exec=sleep 51;workrave
Icon=system-run
Name=Workrave-Slowstart
StartupNotify=true
Terminal=false
Type=Application
EOT
apt_install dconf-cli
ruby <<EOC
PREFIX="/org/workrave"
def dconf_write rel_path, value
  puts "Setting " + rel_path
  print "old: "; system "dconf read #{PREFIX}/#{rel_path}"
  cmd = "dconf write #{PREFIX}/#{rel_path} #{value}"
  #puts cmd
  system cmd
  print "new: "; system "dconf read #{PREFIX}/#{rel_path}"
end
new_settings = {
  "micro-pause" => [3600,  10],
  "rest-break"  => [9600, 300],
  "daily-limit" => [21600]
}
new_settings.each do |name, values|
  limit, duration = values
  dconf_write "timers/" + name + "/limit", limit
  dconf_write "timers/" + name + "/auto-reset", duration if duration
  dconf_write "gui/breaks/" + name + "/skippable-break", "false"
end
dconf_write "gui/applet/enabled", "false"
dconf_write "gui/main-window/enabled", "false"
EOC
sudo sed -i "s/eine Mikropause?/Atem + Frieden? /" /usr/share/locale/de/LC_MESSAGES/workrave.mo

# ToDo: correctly add to existing window rules (--> increase "count")
cat <<eot >>$HOME/.config/kwinrulesrc
[1]
Description=workrave verstecken
clientmachine=biesdorfer
clientmachinematch=0
minimize=true
minimizerule=3
skiptaskbar=true
skiptaskbarrule=2
title=Workrave
titlematch=1
types=1
wmclass=workrave workrave
wmclasscomplete=true
wmclassmatch=1

[General]
count=1
eot

apt_install kteatime

syve_section "Weitere Browser"
 
apt_install chromium-browser
apt_install rekonq


syve_section "Spiele"

apt_install supertux

#syve_section "Lern-Programme installieren"
