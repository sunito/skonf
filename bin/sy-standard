#!/bin/bash

function syve_section {
  echo
  echo $*
  echo
  logger syve_section $*
}

function apt_install {
  echo
  echo Installing $*
  logger SyveInstalling $*
  sudo apt-get --yes install $*
}

# syve_section Skype
apt_install skype


syve_section Wuala

if [ `which wuala` = "" ] ; then
  if [ `uname -i` = "x86_64" ] ; then
    wget https://cdn.wuala.com/repo/deb/wuala_current_amd64.deb
    sudo dpkg -i wuala_current_amd64.deb
  else
    wget https://cdn.wuala.com/repo/deb/wuala_current_i386.deb
    sudo dpkg -i wuala_current_i386.deb
  fi
fi

if [ $USER = "NEW" ] ;then

cat >$HOME/.config/autostart/wuala.desktop <<EOT
[Desktop Entry]
Exec=wuala >/var/log/wuala/wuala-NEW.log
Icon=system-run
Name[de]=Wuala-Starten
Name=Wuala-Starten
StartupNotify=true
Terminal=false
Type=Application
EOT

sudo mkdir /var/log/wuala
sudo chown $USER.users /var/log/wuala

fi # syve_section Wuala

syve_section Pfade

if [ $USER = "NEW" ] ;then
rmdir $HOME/*

cat <<EOT >$HOME/.config/user-dirs.dirs
XDG_DESKTOP_DIR="/dat/N.E.W.-Daten/Desktop"
XDG_DOCUMENTS_DIR="/dat/N.E.W.-Daten/Geschriebseltes"
XDG_DOWNLOAD_DIR="/dat/N.E.W.-Daten/Downloads"
XDG_MUSIC_DIR="/dat/N.E.W.-Daten/Musik"
XDG_PICTURES_DIR="/dat/N.E.W.-Daten/Bilder"
XDG_VIDEOS_DIR="/dat/N.E.W.-Daten/Bilder"
EOT

ln -s /dat/N.E.W.-Daten $HOME
fi # if [ $USER = "NEW" ] ;then

mkdir -p $HOME/.kde/share/apps/solid/actions


if [ $USER = "NEW" ] ;then
cat <<EOT >$HOME/.kde/share/apps/solid/actions/Comp-NachHandykarte.desktop
[Desktop Action open]
Exec=if fehler=`rsync -a --delete /dat/N.E.W.-Daten/HandyKarte/ /media/*/ 2>&1`; then kdialog --msgbox "Kopieren und Löschen auf Handykarte erfolgreich"; else kdialog --msgbox "Fehler beim Synchronisieren Computer --> Karte \\n\\nFehlermeldung:   \\n$fehler"; fi
Icon=kverbos
Name=VonComp-NachHandykarte

[Desktop Entry]
Actions=open;
Type=Service
X-KDE-Action-Custom=true
X-KDE-Solid-Predicate=[StorageVolume.usage == 'FileSystem' AND StorageVolume.ignored == false]
EOT

cat <<EOT >$HOME/.kde/share/apps/solid/actions/VonHandykarte-AufComputer.desktop
[Desktop Action open]
Exec=if fehler=`rsync -au /media/*/ /dat/N.E.W.-Daten/HandyKarte/ 2>&1`; then kdialog --msgbox "Alle Daten der Karte sind jetzt auf dem Computer. \\n(Auf Computer nichts gelöscht)"; else kdialog --msgbox "Fehler beim Synchronisieren Karte --> Computer  \\n\\nFehlermeldung:   \\n$fehler"; fi
Icon=preferences-plugin-script
Name=VonHandykarte-AufComputer

[Desktop Entry]
Actions=open;
Type=Service
X-KDE-Action-Custom=true
X-KDE-Solid-Predicate=[StorageVolume.usage == 'FileSystem' AND StorageVolume.ignored == 'false']
EOT
fi # if [ $USER = "NEW" ] ;then

syve_section Telefon

cat <<EOT >$HOME/.config/autostart/slowstart-sflphone.desktop
[Desktop Entry]
Exec=sleep 11;sflphone-client-kde
Icon=system-run
Name[de]=Slowstart-Sflphone
Name=Slowstart-Sflphone
StartupNotify=true
Terminal=false
Type=Application
EOT

syve_section Weitere Software installieren

sudo add-apt-repository ppa:csoler-users/retroshare
sudo apt-get update >/dev/null
apt_install retroshare

apt_install wine winetricks

syve_section Lern-Programme installieren

if [ $USER = "NEW" ] ;then
sudo dpkg -i /dat/N.E.W.-Daten/Downloads/WorldOfGooDemo.1.41.deb 

apt_install edubuntu-desktop
fi # if [ $USER = "NEW" ] ;then

apt_install ktouch


